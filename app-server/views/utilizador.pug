extends layout

block content

    .w3-light-grey
        header.w3-container.w3-theme-d4.w3-text-white
            a(href="/mainPage" style="text-decoration: none")
                h1.w3-opacity Gestor de Recursos
                    
        .w3-bar.w3-theme-d4
            h3.w3-margin-left Utilizador #{user.username}       
                
        .w3-bar.w3-theme-d4
            span
                if tab === "tab1"
                    button.w3-bar-item.w3-hover-opacity.w3-padding(class="w3-theme-d3 tablink", onclick="openDiv(event, 'perfil', 'nao');") Perfil
                    button.w3-bar-item.w3-hover-opacity.w3-padding(class="w3-theme-d4 tablink", onclick="openDiv(event, 'recursos', 'nao');") Recursos
                else
                    button.w3-bar-item.w3-hover-opacity.w3-padding(class="w3-theme-d4 tablink", onclick="openDiv(event, 'recursos', 'nao');") Perfil
                    button.w3-bar-item.w3-hover-opacity.w3-padding(class="w3-theme-d3 tablink", onclick="openDiv(event, 'perfil', 'nao');") Recursos
                if user.username === username
                    button.w3-right.w3-button.w3-round-large.w3-text-white.w3-medium.w3-hover-red(onclick="addConfirmacao()") Eliminar Conta     
                else
                    if nivel == "admin"
                        - var eliminar = "sim" 
                        button.w3-right.w3-button.w3-round-large.w3-text-white.w3-medium.w3-hover-red(onclick="addConfirmacao()") Eliminar Utilizador

        - var tab1 = "block"   
        - var tab2 = "none"   
        if tab === "tab2"
            - var tab1 = "none"
            - var tab2 = "block"

        div.w3-container.w3-display-container(class="lista", id="perfil", style=`display:${tab1}`)
            h5
                b.w3-text-blue-grey Nível:
                span  #{user.level}

            h5
                b.w3-text-blue-grey Email:
                span  #{user.email}

            h5
                b.w3-text-blue-grey Filiação:
                span  #{user.filiacao}

            h5
                b.w3-text-blue-grey Data Registo:
                span  #{user.dataRegisto}

            h5
                b.w3-text-blue-grey Último Acesso:
                span  #{user.dataLastAcess}


            h5.w3-text-blue-grey
                b Comentários:
                if user.username === username
                    button.w3-right.w3-button.w3-round-large.w3-text-blue-grey.w3-medium(onclick="document.getElementById('removerComentarios').style.display='block'") 
                        b - Remover Comentários

            table.w3-table.w3-border.w3-bordered
                if comentarios.length
                    tr.w3-theme-d3.w3-mobile
                        td Recurso
                        td Texto
                        td.w3-right.w3-margin-right

                    each c in comentarios
                        tr
                            td
                                a(href=`/recurso/${c.recursoID}`) #{c.recursoID}
                            td
                                span  #{c.text}
                            
                            if c.userID === username
                                td.w3-right.w3-margin-right.w3-hover-text-red
                                    a(href=`/comentario/remover/${c._id}?user=${user.username}`) Eliminar

                            else 
                                if nivel == "admin"
                                    td.w3-right.w3-margin-right.w3-hover-text-red
                                        a(href=`/comentario/remover/${c._id}?user=${user.username}`) Eliminar

                            td.w3-right.w3-margin-right #{c.data}
                            
                            
                else
                    span Não existem comentários

            br     
        
        div.w3-display-container(class="lista", id="recursos", style=`display:${tab2}`)
            if pessoais.length

                table.w3-table.w3-bordered
                    tr.w3-theme-d3
                        th(style="width:100px;") ID
                        th(style="width:600px;") Título
                        th.w3-center Tipo
                        th.w3-center Data Registo
                        if nivel === "admin"
                            th.w3-center Visibilidade
                        th
                    each p in pessoais
                        tr(class=`recurso ${p.tipo} ${p.owner} ${p.visibilidade}` style="display:")
                            td.w3-padding-large 
                                a(href=`/recurso/meu/${p.id}`) #{p.id}
                            td.w3-padding-large= p.titulo
                            td.w3-padding-large.w3-center #{p.tipo}
                            td.w3-padding-large.w3-center #{p.dataRegisto} 
                            if nivel === "admin"
                                if p.visibilidade == 1
                                    td.w3-center Privado
                                else
                                    td.w3-center Público
                            
                            td
                                if eliminar  
                                    button.w3-button.w3-padding-small.w3-round.w3-meddium.w3-hover-red.w3-right.w3-margin-right(onclick=`addConfirmacao('recurso', '/recurso/${p.id}/remover?tab=2');`) 
                                        u Eliminar
                                if user.username === username
                                    button.w3-button.w3-padding-small.w3-round.w3-meddium.w3-hover-blue-grey.w3-right.w3-margin-right 
                                        a(href=`/recurso/${p.id}/editar`) Editar
                                
            else
                p.w3-margin-left Não tem recursos.



        //- de certeza que queres eliminar?
        div.w3-modal(id="confirmar" style="display:none")
            div.w3-modal-content.w3-theme-d3.w3-round-large(style="width:450px")
                div.w3-container.w3-padding-16
                    if user.username === username
                        h5.w3-center.w3-margin-bottom Tem a certeza que quer eliminar a sua conta?
                    else
                        h5.w3-center.w3-margin-bottom Tem a certeza que quer eliminar este utilizador?
                    h5.w3-center
                        a(href=`/user/${user.username}/remover?tab=3}`)
                            button.w3-button.w3-round.w3-white.w3-text-blue-grey.w3-medium
                                i(class="fa fa-check")
                        button.w3-button.w3-round.w3-white.w3-text-blue-grey.w3-medium.w3-margin-left(onclick="document.getElementById('confirmar').style.display='none'")
                            i(class="fa fa-close")

        //- de certeza que queres eliminar os comentarios?
        div.w3-modal(id="removerComentarios" style="display:none")
            div.w3-modal-content.w3-theme-d3.w3-round-large(style="width:450px")
                div.w3-container.w3-padding-16
                    h5.w3-center.w3-margin-bottom Tem a certeza que quer eliminar todos os comentários deste utilizador?
                    h5.w3-center
                        a(href=`/user/${user.username}/remover/comentarios`)
                            button.w3-button.w3-round.w3-white.w3-text-blue-grey.w3-medium
                                i(class="fa fa-check")
                        button.w3-button.w3-round.w3-white.w3-text-blue-grey.w3-medium.w3-margin-left(onclick="document.getElementById('removerComentarios').style.display='none'")
                            i(class="fa fa-close")


        .w3-container.w3-theme-d4.w3-text-white.w3-padding.w3-padding-large
            address 
                a(href=`/mainPage?tab=2`) Voltar